--[[
    ro-archive (Fixed Edition)
    English Only | WindUI | ScriptBlox
    Features: Glow ESP, Fixed Aimlock Smoothing, Target HUD Toggle, All Scripts Restored
]]

local WindUI
do
    local ok, result = pcall(function()
        return require("./src/Init")
    end)
    if ok then
        WindUI = result
    else 
        WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
    end
end

local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- // 1. Utility Functions // --

local function safeLoad(url_or_code, isRawCode)
    if not url_or_code or url_or_code == "" then return end
    if isRawCode then
        local ok, err = pcall(function() loadstring(url_or_code)() end)
        if not ok then WindUI:Notify({ Title = "Error", Content = "Execution failed.", Icon = "alert-triangle" }) end
    else
        pcall(function() loadstring(game:HttpGet(url_or_code))() end)
    end
end

local function makeRequest(options)
    local r = request or http_request or (syn and syn.request) or (fluxus and fluxus.request)
    if r then return r(options) else return { Body = game:HttpGet(options.Url) } end
end

local function fetchScriptBlox(query, mode)
    local url = (mode == "trending") and "https://scriptblox.com/api/script/trending" or "https://scriptblox.com/api/script/search?q=" .. HttpService:UrlEncode(query) .. "&mode=free&max=25"
    local s, r = pcall(function() return makeRequest({ Url = url, Method = "GET" }) end)
    if s and r.Body then
        local d = HttpService:JSONDecode(r.Body)
        if d and d.result then return d.result.scripts end
    end
    return {}
end

-- // 2. Player Logic // --
local PlayerConfig = { Speed = 16, Jump = 50, LoopSpeed = false, LoopJump = false }
RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChild("Humanoid")
    if hum then
        if PlayerConfig.LoopSpeed then hum.WalkSpeed = PlayerConfig.Speed end
        if PlayerConfig.LoopJump then hum.UseJumpPower = true; hum.JumpPower = PlayerConfig.Jump end
    end
end)

-- // 3. Ultimate ESP System // --
local ESP = {
    Enabled = false,
    Boxes = false,
    Names = false,
    Health = false,
    Tracers = false,
    Skeleton = false,
    Chams = false, 
    TeamCheck = false,
    EnemyColor = Color3.fromRGB(255, 60, 60),
    TeamColor = Color3.fromRGB(60, 255, 60),
    Drawings = {},
    Highlights = {}
}

local function CreateDrawing(type, props)
    local draw = Drawing.new(type)
    for k, v in pairs(props) do draw[k] = v end
    return draw
end

local function ClearESP(plr)
    if ESP.Drawings[plr] then
        for _, v in pairs(ESP.Drawings[plr]) do 
            if type(v) == "table" then for _, l in pairs(v) do l:Remove() end 
            else v:Remove() end
        end
        ESP.Drawings[plr] = nil
    end
    if ESP.Highlights[plr] then
        ESP.Highlights[plr]:Destroy()
        ESP.Highlights[plr] = nil
    end
end

-- Bone Connections
local SkeletonConnections = {
    {"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"}, {"LowerTorso", "LeftUpperLeg"}, {"LeftUpperLeg", "LeftLowerLeg"}, {"LeftLowerLeg", "LeftFoot"},
    {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}, {"RightLowerLeg", "RightFoot"}, {"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"},
    {"LeftLowerArm", "LeftHand"}, {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"}
}
local SkeletonConnectionsR6 = {
    {"Head", "Torso"}, {"Torso", "Left Leg"}, {"Torso", "Right Leg"}, {"Torso", "Left Arm"}, {"Torso", "Right Arm"}
}

local function UpdateESP()
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            if not ESP.Enabled then ClearESP(plr); continue end

            local char = plr.Character
            local hum = char and char:FindFirstChild("Humanoid")
            local root = char and char:FindFirstChild("HumanoidRootPart")

            if char and hum and root and hum.Health > 0 then
                local isEnemy = true
                if ESP.TeamCheck and plr.Team == LocalPlayer.Team then isEnemy = false end
                local color = isEnemy and ESP.EnemyColor or ESP.TeamColor

                -- GLOW
                if ESP.Chams then
                    if not ESP.Highlights[plr] then
                        local hl = Instance.new("Highlight")
                        hl.Name = "EspHighlight"
                        hl.FillTransparency = 0.5
                        hl.OutlineTransparency = 0
                        hl.Adornee = char
                        hl.Parent = game:GetService("CoreGui")
                        ESP.Highlights[plr] = hl
                    end
                    ESP.Highlights[plr].FillColor = color
                    ESP.Highlights[plr].OutlineColor = color
                    ESP.Highlights[plr].Enabled = true
                else
                    if ESP.Highlights[plr] then ESP.Highlights[plr].Enabled = false end
                end

                -- DRAWINGS
                if not ESP.Drawings[plr] then
                    ESP.Drawings[plr] = {
                        Box = CreateDrawing("Square", {Thickness = 1.5, Filled = false, Transparency = 1}),
                        Name = CreateDrawing("Text", {Size = 13, Center = true, Outline = true, Font = 2}),
                        HealthBar = CreateDrawing("Line", {Thickness = 2, Transparency = 1}),
                        Tracer = CreateDrawing("Line", {Thickness = 1, Transparency = 1}),
                        SkeletonLines = {} 
                    }
                end
                
                local objs = ESP.Drawings[plr]
                local vector, onScreen = Camera:WorldToViewportPoint(root.Position)

                if onScreen then
                    local head = char:FindFirstChild("Head")
                    local topPos = head and (head.Position + Vector3.new(0, 0.5, 0)) or (root.Position + Vector3.new(0, 3, 0))
                    local botPos = root.Position - Vector3.new(0, 3.5, 0)
                    local topVec = Camera:WorldToViewportPoint(topPos)
                    local botVec = Camera:WorldToViewportPoint(botPos)
                    local height = math.abs(topVec.Y - botVec.Y)
                    local width = height / 1.6
                    local boxPos = Vector2.new(vector.X - width / 2, vector.Y - height / 2)

                    if ESP.Boxes then
                        objs.Box.Visible = true; objs.Box.Color = color
                        objs.Box.Size = Vector2.new(width, height); objs.Box.Position = boxPos
                    else objs.Box.Visible = false end

                    if ESP.Names then
                        objs.Name.Visible = true; objs.Name.Color = color
                        objs.Name.Text = string.format("%s [%dm]", plr.Name, math.floor((root.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude))
                        objs.Name.Position = Vector2.new(vector.X, vector.Y - height / 2 - 16)
                    else objs.Name.Visible = false end

                    if ESP.Health then
                        local hp = hum.Health / hum.MaxHealth
                        objs.HealthBar.Visible = true; objs.HealthBar.Color = Color3.fromHSV(hp * 0.3, 1, 1)
                        objs.HealthBar.From = Vector2.new(boxPos.X - 5, boxPos.Y + height)
                        objs.HealthBar.To = Vector2.new(boxPos.X - 5, boxPos.Y + height - (height * hp))
                    else objs.HealthBar.Visible = false end

                    if ESP.Tracers then
                        objs.Tracer.Visible = true; objs.Tracer.Color = color
                        objs.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                        objs.Tracer.To = Vector2.new(vector.X, vector.Y)
                    else objs.Tracer.Visible = false end
                    
                    if ESP.Skeleton then
                        local rigType = (char:FindFirstChild("UpperTorso")) and "R15" or "R6"
                        local conns = (rigType == "R15") and SkeletonConnections or SkeletonConnectionsR6
                        
                        if #objs.SkeletonLines < #conns then
                            for i = 1, #conns do
                                if not objs.SkeletonLines[i] then
                                    objs.SkeletonLines[i] = CreateDrawing("Line", {Thickness = 1.5, Transparency = 1})
                                end
                            end
                        end

                        for i, connection in ipairs(conns) do
                            local p1 = char:FindFirstChild(connection[1])
                            local p2 = char:FindFirstChild(connection[2])
                            local line = objs.SkeletonLines[i]

                            if p1 and p2 and line then
                                local v1, s1 = Camera:WorldToViewportPoint(p1.Position)
                                local v2, s2 = Camera:WorldToViewportPoint(p2.Position)

                                if s1 and s2 then
                                    line.Visible = true; line.Color = color
                                    line.From = Vector2.new(v1.X, v1.Y)
                                    line.To = Vector2.new(v2.X, v2.Y)
                                else line.Visible = false end
                            elseif line then line.Visible = false end
                        end
                    else
                        for _, line in pairs(objs.SkeletonLines) do line.Visible = false end
                    end

                else
                    objs.Box.Visible = false; objs.Name.Visible = false; objs.HealthBar.Visible = false; objs.Tracer.Visible = false
                    for _, line in pairs(objs.SkeletonLines) do line.Visible = false end
                end
            else ClearESP(plr) end
        else ClearESP(plr) end
    end
end
RunService.RenderStepped:Connect(UpdateESP)
Players.PlayerRemoving:Connect(ClearESP)

-- // 4. Target HUD System // --
local TargetHUD = {
    Gui = nil,
    Container = nil,
    Viewport = nil,
    NameLabel = nil,
    ToolLabel = nil,
    HealthBar = nil,
    HealthText = nil,
    CurrentTarget = nil
}

local function CreateTargetHUD()
    if TargetHUD.Gui then TargetHUD.Gui:Destroy() end
    
    local gui = Instance.new("ScreenGui")
    gui.Name = "roArchiveTargetHUD"
    gui.Parent = game:GetService("CoreGui")
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.fromOffset(260, 90)
    frame.Position = UDim2.new(0.5, 40, 0.5, -45)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    frame.BorderSizePixel = 0
    frame.BackgroundTransparency = 0.1
    frame.Visible = false
    frame.Parent = gui
    
    local corner = Instance.new("UICorner"); corner.CornerRadius = UDim.new(0, 8); corner.Parent = frame
    local stroke = Instance.new("UIStroke"); stroke.Thickness = 1.5; stroke.Color = Color3.fromRGB(0, 255, 135); stroke.Parent = frame

    local view = Instance.new("ViewportFrame")
    view.Size = UDim2.fromOffset(80, 80)
    view.Position = UDim2.fromOffset(5, 5)
    view.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    view.BorderSizePixel = 0
    view.BackgroundTransparency = 0.5
    view.Parent = frame
    local vCorner = Instance.new("UICorner"); vCorner.CornerRadius = UDim.new(0, 6); vCorner.Parent = view

    local nameLbl = Instance.new("TextLabel")
    nameLbl.Size = UDim2.new(1, -95, 0, 25)
    nameLbl.Position = UDim2.fromOffset(90, 5)
    nameLbl.BackgroundTransparency = 1
    nameLbl.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLbl.Font = Enum.Font.GothamBold
    nameLbl.TextSize = 16
    nameLbl.TextXAlignment = Enum.TextXAlignment.Left
    nameLbl.TextTruncate = Enum.TextTruncate.AtEnd
    nameLbl.Text = "Target Name"
    nameLbl.Parent = frame

    local toolLbl = Instance.new("TextLabel")
    toolLbl.Size = UDim2.new(1, -95, 0, 20)
    toolLbl.Position = UDim2.fromOffset(90, 30)
    toolLbl.BackgroundTransparency = 1
    toolLbl.TextColor3 = Color3.fromRGB(200, 200, 200)
    toolLbl.Font = Enum.Font.Gotham
    toolLbl.TextSize = 13
    toolLbl.TextXAlignment = Enum.TextXAlignment.Left
    toolLbl.Text = "Holding: None"
    toolLbl.Parent = frame

    local hpBg = Instance.new("Frame")
    hpBg.Size = UDim2.new(1, -100, 0, 6)
    hpBg.Position = UDim2.fromOffset(90, 65)
    hpBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    hpBg.BorderSizePixel = 0
    hpBg.Parent = frame
    local hpCorner = Instance.new("UICorner"); hpCorner.Parent = hpBg
    
    local hpFill = Instance.new("Frame")
    hpFill.Size = UDim2.fromScale(1, 1)
    hpFill.BackgroundColor3 = Color3.fromRGB(0, 255, 100)
    hpFill.BorderSizePixel = 0
    hpFill.Parent = hpBg
    local fillCorner = Instance.new("UICorner"); fillCorner.Parent = hpFill
    
    local hpText = Instance.new("TextLabel")
    hpText.Size = UDim2.new(1, -100, 0, 15)
    hpText.Position = UDim2.fromOffset(90, 72)
    hpText.BackgroundTransparency = 1
    hpText.TextColor3 = Color3.fromRGB(150, 150, 150)
    hpText.Font = Enum.Font.GothamBold
    hpText.TextSize = 11
    hpText.TextXAlignment = Enum.TextXAlignment.Left
    hpText.Text = "100/100 HP"
    hpText.Parent = frame

    TargetHUD.Gui = gui
    TargetHUD.Container = frame
    TargetHUD.Viewport = view
    TargetHUD.NameLabel = nameLbl
    TargetHUD.ToolLabel = toolLbl
    TargetHUD.HealthBar = hpFill
    TargetHUD.HealthText = hpText
end

local function UpdateTargetHUD(target)
    if not TargetHUD.Gui then CreateTargetHUD() end
    
    if not target or not target.Character then
        TargetHUD.Container.Visible = false
        TargetHUD.CurrentTarget = nil
        return
    end

    TargetHUD.Container.Visible = true
    TargetHUD.NameLabel.Text = target.Name

    local hum = target.Character:FindFirstChild("Humanoid")
    if hum then
        local hp = math.floor(hum.Health)
        local maxHp = math.floor(hum.MaxHealth)
        TargetHUD.HealthBar.Size = UDim2.fromScale(math.clamp(hp/maxHp, 0, 1), 1)
        TargetHUD.HealthBar.BackgroundColor3 = Color3.fromHSV((hp/maxHp)*0.3, 1, 1)
        TargetHUD.HealthText.Text = hp .. " / " .. maxHp .. " HP"
    end

    local tool = target.Character:FindFirstChildOfClass("Tool")
    if tool then
        TargetHUD.ToolLabel.Text = "Holding: " .. tool.Name
        TargetHUD.ToolLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    else
        TargetHUD.ToolLabel.Text = "Holding: None"
        TargetHUD.ToolLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    end

    if TargetHUD.CurrentTarget ~= target then
        TargetHUD.CurrentTarget = target
        TargetHUD.Viewport:ClearAllChildren()
        
        local worldModel = Instance.new("WorldModel")
        worldModel.Parent = TargetHUD.Viewport
        local cam = Instance.new("Camera")
        cam.Parent = TargetHUD.Viewport
        TargetHUD.Viewport.CurrentCamera = cam
        
        target.Character.Archivable = true
        local clone = target.Character:Clone()
        clone.Parent = worldModel
        
        local root = clone:FindFirstChild("HumanoidRootPart") or clone:FindFirstChild("Torso") or clone:FindFirstChild("Head")
        if root then
            cam.CFrame = CFrame.new(root.Position + (root.CFrame.LookVector * 5) + Vector3.new(0, 2, 0), root.Position)
        end
        
        for _, v in pairs(clone:GetDescendants()) do
            if v:IsA("Script") or v:IsA("LocalScript") then v:Destroy() end
        end
    end
end

CreateTargetHUD()

-- // 5. Aimlock System (Fixed Smoothing) // --
local Aimlock = {
    Enabled = false,
    Key = Enum.KeyCode.E,
    IsHolding = false,
    LockedTarget = nil,
    FOV = 100,
    ShowFOV = false,
    Smoothing = 0, 
    TargetPart = "Head",
    TeamCheck = false,
    WallCheck = false,
    UseHUD = true -- Default enabled
}

local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 1.5; FOVCircle.NumSides = 64; FOVCircle.Radius = 100; FOVCircle.Filled = false; FOVCircle.Visible = false; FOVCircle.Color = Color3.fromRGB(255, 255, 255)

local function IsVisible(targetPart)
    if not Aimlock.WallCheck then return true end
    local origin = Camera.CFrame.Position
    local direction = targetPart.Position - origin
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    params.FilterType = Enum.RaycastFilterType.Exclude
    local result = Workspace:Raycast(origin, direction, params)
    return (result and result.Instance:IsDescendantOf(targetPart.Parent))
end

local function GetBestTarget()
    local closest = nil
    local shortestDist = Aimlock.FOV
    local mousePos = Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y)

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            if Aimlock.TeamCheck and plr.Team == LocalPlayer.Team then continue end
            
            local char = plr.Character
            local hum = char and char:FindFirstChild("Humanoid")
            local part = char and char:FindFirstChild(Aimlock.TargetPart)

            if char and hum and hum.Health > 0 and part then
                local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
                if onScreen then
                    local dist = (mousePos - Vector2.new(pos.X, pos.Y)).Magnitude
                    if dist < shortestDist then
                        if IsVisible(part) then
                            closest = plr
                            shortestDist = dist
                        end
                    end
                end
            end
        end
    end
    return closest
end

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Aimlock.Key and Aimlock.Enabled then 
        Aimlock.IsHolding = true 
        Aimlock.LockedTarget = GetBestTarget()
    end
end)
UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode == Aimlock.Key then 
        Aimlock.IsHolding = false; 
        Aimlock.LockedTarget = nil
        UpdateTargetHUD(nil) 
    end
end)

RunService.RenderStepped:Connect(function()
    FOVCircle.Visible = Aimlock.Enabled and Aimlock.ShowFOV
    FOVCircle.Radius = Aimlock.FOV
    FOVCircle.Position = UserInputService:GetMouseLocation()

    if Aimlock.Enabled and Aimlock.IsHolding and Aimlock.LockedTarget then
        local target = Aimlock.LockedTarget
        local char = target.Character
        local part = char and char:FindFirstChild(Aimlock.TargetPart)
        local hum = char and char:FindFirstChild("Humanoid")

        if char and part and hum and hum.Health > 0 then
            
            -- Handle HUD based on toggle
            if Aimlock.UseHUD then UpdateTargetHUD(target) else UpdateTargetHUD(nil) end

            if Aimlock.WallCheck and not IsVisible(part) then 
                Aimlock.LockedTarget = nil 
                UpdateTargetHUD(nil)
                return 
            end

            local currentCFrame = Camera.CFrame
            local targetCFrame = CFrame.new(currentCFrame.Position, part.Position)
            
            -- FIXED SMOOTHING LOGIC
            -- If smoothing is 0: Alpha = 1 (Instant)
            -- If smoothing is 10: Alpha = ~0.09 (Slow)
            local alpha = 1 / (Aimlock.Smoothing + 1)
            
            Camera.CFrame = currentCFrame:Lerp(targetCFrame, alpha)
        else
            Aimlock.LockedTarget = nil
            UpdateTargetHUD(nil)
        end
    else
        UpdateTargetHUD(nil)
    end
end)

-- // 6. UI // --
local Window = WindUI:CreateWindow({
    Title = "ro-archive  |  Fixed Edition",
    Author = "sdwird",
    Folder = "ro-archive-fix",
    Icon = "archive", 
    IconSize = 20,
    NewElements = true,
    Transparent = true, 
    Theme = "Dark",
    KeySystem = { Title = "Security", Note = "Key: 1234", KeyValidator = function(k) return k == "1234" end }
})

local MainSection = Window:Section({ Title = "Dashboard" })
local PlayerSection = Window:Section({ Title = "Player & Combat" })
local CloudSection = Window:Section({ Title = "Cloud" })
local SettingsSection = Window:Section({ Title = "Settings" })

-- Dashboard
local HomeTab = MainSection:Tab({ Title = "Home", Icon = "house" })
HomeTab:Paragraph({ Title = "ro-archive", Desc = "Script Hub & Tools", Image = "rbxassetid://129260712070622", ImageSize = 48 })
HomeTab:Button({ Title = "Close Interface", Icon = "eye-off", Color = Color3.fromHex("#ff4830"), Callback = function() Window:Toggle() end })
Window:Tag({ Title = "v" .. WindUI.Version, Icon = "github", Color = Color3.fromHex("#6b31ff") })

-- Local Scripts
local LocalTab = MainSection:Tab({ Title = "Local Scripts", Icon = "file-code" })
local function addLocalScript(title, desc, icon, url, afterInfo)
    LocalTab:Button({ Title = title, Desc = desc, Icon = icon, Callback = function() if afterInfo then pcall(afterInfo) end safeLoad(url, false) end })
end
addLocalScript("Zenware Crim Aimlock", "Key: NewSigmaSigmaBoy", "target", "https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/zenware-criminality.lua", function() setclipboard("NewSigmaSigmaBoy") end)
addLocalScript("Demonology ESP", "Visuals only", "eye", "https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/demonology-esp.lua") -- RESTORED
addLocalScript("Build A Boat", "Auto farm & tools", "anchor", "https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/babft-asu.lua")

-- Hubs
local HubsTab = MainSection:Tab({ Title = "Hubs", Icon = "globe" })
HubsTab:Section({ Title = "Universal" })
HubsTab:Button({ Title = "Infinite Yield", Icon = "terminal", Callback = function() safeLoad("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", false) end })

HubsTab:Section({ Title = "Solara Hubs" }) -- RESTORED
HubsTab:Button({ Title = "Skibidi Solara (Orion)", Icon = "zap", Callback = function() safeLoad("https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/skibidi-solara-hub.lua", false) end })
HubsTab:Button({ Title = "Skibidi Solara (Auto)", Icon = "radar", Callback = function() safeLoad("https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/skibidihub-rayfield", false) end })
HubsTab:Button({ Title = "Solara Hub (Normal)", Icon = "folder-open", Callback = function() safeLoad("https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/solara-hub.lua", false) end })

-- [ PLAYER FUNCTIONS ] --
local MoveTab = PlayerSection:Tab({ Title = "Movement", Icon = "footprints" })
MoveTab:Slider({ Title = "Walk Speed", Value = { Min = 16, Max = 300, Default = 16 }, Callback = function(v) PlayerConfig.Speed = v; if not PlayerConfig.LoopSpeed then LocalPlayer.Character.Humanoid.WalkSpeed = v end end })
MoveTab:Toggle({ Title = "Loop Speed", Value = false, Callback = function(v) PlayerConfig.LoopSpeed = v end })
MoveTab:Slider({ Title = "Jump Power", Value = { Min = 50, Max = 300, Default = 50 }, Callback = function(v) PlayerConfig.Jump = v; if not PlayerConfig.LoopJump then LocalPlayer.Character.Humanoid.JumpPower = v end end })
MoveTab:Toggle({ Title = "Loop Jump", Value = false, Callback = function(v) PlayerConfig.LoopJump = v end })

local VisualsTab = PlayerSection:Tab({ Title = "Visuals", Icon = "eye" })
VisualsTab:Toggle({ Title = "Enable ESP", Value = false, Callback = function(v) ESP.Enabled = v end })
VisualsTab:Section({ Title = "Features" })
VisualsTab:Toggle({ Title = "Glowing Chams", Value = false, Callback = function(v) ESP.Chams = v end })
VisualsTab:Toggle({ Title = "Skeleton", Value = false, Callback = function(v) ESP.Skeleton = v end })
VisualsTab:Toggle({ Title = "2D Boxes", Value = false, Callback = function(v) ESP.Boxes = v end })
VisualsTab:Toggle({ Title = "Names & Distance", Value = false, Callback = function(v) ESP.Names = v end })
VisualsTab:Toggle({ Title = "Health Bar", Value = false, Callback = function(v) ESP.Health = v end })
VisualsTab:Toggle({ Title = "Tracers", Value = false, Callback = function(v) ESP.Tracers = v end })
VisualsTab:Section({ Title = "Settings" })
VisualsTab:Toggle({ Title = "Team Check", Value = false, Callback = function(v) ESP.TeamCheck = v end })
VisualsTab:Colorpicker({ Title = "Enemy Color", Default = Color3.fromRGB(255, 60, 60), Callback = function(v) ESP.EnemyColor = v end })
VisualsTab:Colorpicker({ Title = "Team Color", Default = Color3.fromRGB(60, 255, 60), Callback = function(v) ESP.TeamColor = v end })

local CombatTab = PlayerSection:Tab({ Title = "Combat", Icon = "crosshair" })
CombatTab:Toggle({ Title = "Enable Aimlock", Value = false, Callback = function(v) Aimlock.Enabled = v end })
CombatTab:Keybind({ Title = "Aim Key", Value = "E", Callback = function(v) Aimlock.Key = Enum.KeyCode[v] end })
CombatTab:Dropdown({ Title = "Target Part", Values = {"Head", "Torso", "HumanoidRootPart"}, Value = "Head", Callback = function(v) Aimlock.TargetPart = v end })
CombatTab:Slider({ 
    Title = "Smoothing", 
    Desc = "0 = Instant, 10 = Very Smooth", 
    Value = { Min = 0, Max = 10, Default = 0 }, 
    Step = 1, 
    Callback = function(v) Aimlock.Smoothing = v end 
})
CombatTab:Toggle({ Title = "Show Target HUD", Desc = "Toggle 3D preview", Value = true, Callback = function(v) Aimlock.UseHUD = v end }) -- HUD TOGGLE
CombatTab:Toggle({ Title = "Wall Check", Desc = "Ignore walls", Value = false, Callback = function(v) Aimlock.WallCheck = v end })
CombatTab:Toggle({ Title = "Show FOV", Value = false, Callback = function(v) Aimlock.ShowFOV = v end })
CombatTab:Slider({ Title = "FOV Radius", Value = { Min = 10, Max = 800, Default = 100 }, Callback = function(v) Aimlock.FOV = v end })

-- Cloud & Settings
local CloudTab = CloudSection:Tab({ Title = "ScriptBlox", Icon = "cloud-download" })
local currentScripts = {} 
local selectedScript = nil

CloudTab:Input({
    Title = "Search ScriptBlox", Icon = "search",
    Callback = function(query)
        if query == "" then return end
        WindUI:Notify({ Title = "API", Content = "Searching...", Icon = "loader" })
        task.spawn(function()
            local results = fetchScriptBlox(query, "search")
            currentScripts = results
            local names = {}
            for _, s in ipairs(results) do table.insert(names, s.title) end
            _G.ResultsDrop:Refresh(names)
            WindUI:Notify({ Title = "Success", Content = #results .. " scripts found.", Icon = "check" })
        end)
    end
})
_G.ResultsDrop = CloudTab:Dropdown({
    Title = "Select Script", Values = {"Search first..."}, Value = "Search first...",
    Callback = function(val)
        for _, s in ipairs(currentScripts) do if s.title == val then selectedScript = s break end end
        _G.DetailsBtn:Highlight()
    end
})
CloudTab:Space()
_G.DetailsBtn = CloudTab:Button({
    Title = "View & Execute", Icon = "expand", Color = Color3.fromHex("#007bff"),
    Callback = function()
        if not selectedScript then return end
        local s = selectedScript
        local content = string.format("<b>Game:</b> %s\n<b>Views:</b> %s\n<b>Key:</b> %s", s.game and s.game.name or "?", s.views or 0, s.key and "Yes" or "No")
        WindUI:Popup({ Title = s.title, Content = content, Buttons = {
            { Title = "Cancel", Variant = "Secondary", Callback = function() end },
            { Title = "Execute", Variant = "Primary", Callback = function() if s.key then setclipboard(s.keyLink) end safeLoad(s.script, true) end }
        }})
    end
})

local SettingsTab = SettingsSection:Tab({ Title = "Interface", Icon = "settings" })
local themeNames = {}
for name in pairs(WindUI:GetThemes()) do table.insert(themeNames, name) end
SettingsTab:Dropdown({ Title = "Theme", Values = themeNames, Value = "Dark", Callback = function(v) WindUI:SetTheme(v) end })
SettingsTab:Keybind({ Title = "Menu Toggle", Value = "H", Callback = function(key) Window:SetToggleKey(Enum.KeyCode[key]) end })

WindUI:Notify({ Title = "ro-archive loaded", Content = "All systems operational.", Duration = 4 })
