--[[
    ro-archive (v6 Community Edition) + WindUI Example Merge
    Merged Features: Solar Icons, Dynamic Discord API, UI Demo Tab, Full ESP/Aimbot
]]

local WindUI
do
    local ok, result = pcall(function()
        return require("./src/Init")
    end)
    if ok then
        WindUI = result
    else 
        WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
    end
end

-- // [MERGE] 0. Icon Registration (From Example) // --
WindUI.Creator.AddIcons("solar", {
    ["CheckSquareBold"] = "rbxassetid://132438947521974",
    ["CursorSquareBold"] = "rbxassetid://120306472146156",
    ["FileTextBold"] = "rbxassetid://89294979831077",
    ["FolderWithFilesBold"] = "rbxassetid://74631950400584",
    ["HamburgerMenuBold"] = "rbxassetid://134384554225463",
    ["Home2Bold"] = "rbxassetid://92190299966310",
    ["InfoSquareBold"] = "rbxassetid://119096461016615",
    ["PasswordMinimalisticInputBold"] = "rbxassetid://109919668957167",
    ["SolarSquareTransferHorizontalBold"] = "rbxassetid://125444491429160",
})

-- // Global Connections Table (For Safe Unload) // --
local Connections = {} 

local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- // WEBHOOK CONFIG // --
local WebhookURL = "https://discord.com/api/webhooks/1445877108177109143/TKV63RC2goiGOcTlPSXEk2pQWjMLFzu4C6au885WKsBuz12u8J24KPGPyD0E3UcfJzIk"

-- // 1. Utility Functions // --

local function safeLoad(url_or_code, isRawCode)
    if not url_or_code or url_or_code == "" then return end
    if isRawCode then
        local ok, err = pcall(function() loadstring(url_or_code)() end)
        if not ok then WindUI:Notify({ Title = "Error", Content = "Execution failed.", Icon = "alert-triangle" }) end
    else
        pcall(function() loadstring(game:HttpGet(url_or_code))() end)
    end
end

local function makeRequest(options)
    local r = request or http_request or (syn and syn.request) or (fluxus and fluxus.request)
    if r then return r(options) else return { Body = game:HttpGet(options.Url) } end
end

-- Updated Webhook Function with Rating & Type
local function sendWebhook(msg, rating, ftype)
    local req = request or http_request or (syn and syn.request) or (fluxus and fluxus.request)
    if req then
        local color = 16711680 -- Red (Low)
        if rating == "⭐⭐⭐⭐⭐" or rating == "⭐⭐⭐⭐" then color = 65280 end -- Green (High)
        if rating == "⭐⭐⭐" then color = 16776960 end -- Yellow (Mid)

        req({
            Url = WebhookURL,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = HttpService:JSONEncode({
                content = "",
                embeds = {{
                    title = "New " .. ftype,
                    description = "**Message:**\n" .. (msg ~= "" and msg or "No message provided."),
                    color = color,
                    fields = {
                        { name = "Rating", value = rating, inline = true },
                        { name = "Type", value = ftype, inline = true },
                        { name = "User", value = LocalPlayer.Name .. " ("..LocalPlayer.UserId..")", inline = false },
                        { name = "Game ID", value = tostring(game.GameId), inline = true }
                    },
                    footer = { text = "ro-archive v6 System" },
                    timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
                }}
            })
        })
    end
end

local function fetchScriptBlox(query, mode)
    local url = (mode == "trending") and "https://scriptblox.com/api/script/trending" or "https://scriptblox.com/api/script/search?q=" .. HttpService:UrlEncode(query) .. "&mode=free&max=25"
    local s, r = pcall(function() return makeRequest({ Url = url, Method = "GET" }) end)
    if s and r.Body then
        local d = HttpService:JSONDecode(r.Body)
        if d and d.result then return d.result.scripts end
    end
    return {}
end

-- // 2. Player Logic // --
local PlayerConfig = { Speed = 16, Jump = 50, LoopSpeed = false, LoopJump = false }
local PlayerLoop = RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChild("Humanoid")
    if hum then
        if PlayerConfig.LoopSpeed then hum.WalkSpeed = PlayerConfig.Speed end
        if PlayerConfig.LoopJump then hum.UseJumpPower = true; hum.JumpPower = PlayerConfig.Jump end
    end
end)
table.insert(Connections, PlayerLoop) 

-- // 3. Ultimate ESP System // --
local ESP = {
    Enabled = false,
    Boxes = false, Names = false, Health = false, Tracers = false, Skeleton = false, Chams = false, 
    TeamCheck = false,
    EnemyColor = Color3.fromRGB(255, 60, 60),
    TeamColor = Color3.fromRGB(60, 255, 60),
    Drawings = {},
    Highlights = {},
    RigCache = {}
}

local function CreateDrawing(type, props)
    local draw = Drawing.new(type)
    for k, v in pairs(props) do draw[k] = v end
    return draw
end

local function ClearESP(plr)
    if ESP.Drawings[plr] then
        for _, v in pairs(ESP.Drawings[plr]) do 
            if type(v) == "table" then for _, l in pairs(v) do l:Remove() end 
            else v:Remove() end
        end
        ESP.Drawings[plr] = nil
    end
    if ESP.Highlights[plr] then
        ESP.Highlights[plr]:Destroy()
        ESP.Highlights[plr] = nil
    end
    ESP.RigCache[plr] = nil
end

local SkeletonConnections = {
    {"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"}, {"LowerTorso", "LeftUpperLeg"}, {"LeftUpperLeg", "LeftLowerLeg"}, {"LeftLowerLeg", "LeftFoot"},
    {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}, {"RightLowerLeg", "RightFoot"}, {"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"},
    {"LeftLowerArm", "LeftHand"}, {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"}
}
local SkeletonConnectionsR6 = {
    {"Head", "Torso"}, {"Torso", "Left Leg"}, {"Torso", "Right Leg"}, {"Torso", "Left Arm"}, {"Torso", "Right Arm"}
}

local function UpdateESP()
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            if not ESP.Enabled then ClearESP(plr); continue end

            local char = plr.Character
            local hum = char and char:FindFirstChild("Humanoid")
            local root = char and char:FindFirstChild("HumanoidRootPart")

            if char and hum and root and hum.Health > 0 then
                local isEnemy = true
                if ESP.TeamCheck and plr.Team == LocalPlayer.Team then isEnemy = false end
                local color = isEnemy and ESP.EnemyColor or ESP.TeamColor

                if ESP.Chams then
                    if not ESP.Highlights[plr] then
                        local hl = Instance.new("Highlight")
                        hl.Name = "EspHighlight"
                        hl.FillTransparency = 0.5
                        hl.OutlineTransparency = 0
                        hl.Adornee = char
                        hl.Parent = game:GetService("CoreGui")
                        ESP.Highlights[plr] = hl
                    end
                    ESP.Highlights[plr].FillColor = color
                    ESP.Highlights[plr].OutlineColor = color
                    ESP.Highlights[plr].Enabled = true
                else
                    if ESP.Highlights[plr] then ESP.Highlights[plr].Enabled = false end
                end

                if not ESP.Drawings[plr] then
                    ESP.Drawings[plr] = {
                        Box = CreateDrawing("Square", {Thickness = 1.5, Filled = false, Transparency = 1}),
                        Name = CreateDrawing("Text", {Size = 13, Center = true, Outline = true, Font = 2}),
                        HealthBar = CreateDrawing("Line", {Thickness = 2, Transparency = 1}),
                        Tracer = CreateDrawing("Line", {Thickness = 1, Transparency = 1}),
                        SkeletonLines = {} 
                    }
                end
                
                local objs = ESP.Drawings[plr]
                local vector, onScreen = Camera:WorldToViewportPoint(root.Position)

                if onScreen then
                    local head = char:FindFirstChild("Head")
                    local topPos = head and (head.Position + Vector3.new(0, 0.5, 0)) or (root.Position + Vector3.new(0, 3, 0))
                    local botPos = root.Position - Vector3.new(0, 3.5, 0)
                    local topVec = Camera:WorldToViewportPoint(topPos)
                    local botVec = Camera:WorldToViewportPoint(botPos)
                    local height = math.abs(topVec.Y - botVec.Y)
                    local width = height / 1.6
                    local boxPos = Vector2.new(vector.X - width / 2, vector.Y - height / 2)

                    if ESP.Boxes then
                        objs.Box.Visible = true; objs.Box.Color = color
                        objs.Box.Size = Vector2.new(width, height); objs.Box.Position = boxPos
                    else objs.Box.Visible = false end

                    if ESP.Names then
                        objs.Name.Visible = true; objs.Name.Color = color
                        objs.Name.Text = string.format("%s [%dm]", plr.Name, math.floor((root.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude))
                        objs.Name.Position = Vector2.new(vector.X, vector.Y - height / 2 - 16)
                    else objs.Name.Visible = false end

                    if ESP.Health then
                        local hp = hum.Health / hum.MaxHealth
                        objs.HealthBar.Visible = true; objs.HealthBar.Color = Color3.fromHSV(hp * 0.3, 1, 1)
                        objs.HealthBar.From = Vector2.new(boxPos.X - 5, boxPos.Y + height)
                        objs.HealthBar.To = Vector2.new(boxPos.X - 5, boxPos.Y + height - (height * hp))
                    else objs.HealthBar.Visible = false end

                    if ESP.Tracers then
                        objs.Tracer.Visible = true; objs.Tracer.Color = color
                        objs.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                        objs.Tracer.To = Vector2.new(vector.X, vector.Y)
                    else objs.Tracer.Visible = false end
                    
                    if ESP.Skeleton then
                        if not ESP.RigCache[plr] then
                            ESP.RigCache[plr] = (char:FindFirstChild("UpperTorso")) and "R15" or "R6"
                        end
                        local conns = (ESP.RigCache[plr] == "R15") and SkeletonConnections or SkeletonConnectionsR6
                        
                        if #objs.SkeletonLines < #conns then
                            for i = 1, #conns do
                                if not objs.SkeletonLines[i] then objs.SkeletonLines[i] = CreateDrawing("Line", {Thickness = 1.5, Transparency = 1}) end
                            end
                        end

                        for i, connection in ipairs(conns) do
                            local p1 = char:FindFirstChild(connection[1])
                            local p2 = char:FindFirstChild(connection[2])
                            local line = objs.SkeletonLines[i]
                            if p1 and p2 and line then
                                local v1, s1 = Camera:WorldToViewportPoint(p1.Position)
                                local v2, s2 = Camera:WorldToViewportPoint(p2.Position)
                                if s1 and s2 then
                                    line.Visible = true; line.Color = color; line.From = Vector2.new(v1.X, v1.Y); line.To = Vector2.new(v2.X, v2.Y)
                                else line.Visible = false end
                            elseif line then line.Visible = false end
                        end
                    else
                        for _, line in pairs(objs.SkeletonLines) do line.Visible = false end
                    end

                else
                    objs.Box.Visible = false; objs.Name.Visible = false; objs.HealthBar.Visible = false; objs.Tracer.Visible = false
                    for _, line in pairs(objs.SkeletonLines) do line.Visible = false end
                end
            else ClearESP(plr) end
        else ClearESP(plr) end
    end
end
local EspLoop = RunService.RenderStepped:Connect(UpdateESP)
table.insert(Connections, EspLoop)
Players.PlayerRemoving:Connect(ClearESP)

-- // 4. Target HUD System // --
local TargetHUD = { Gui = nil, Container = nil, Viewport = nil, NameLabel = nil, ToolLabel = nil, HealthBar = nil, HealthText = nil, CurrentTarget = nil }

local function CreateTargetHUD()
    if TargetHUD.Gui then TargetHUD.Gui:Destroy() end
    local gui = Instance.new("ScreenGui"); gui.Name = "roArchiveTargetHUD"; gui.Parent = game:GetService("CoreGui")
    local frame = Instance.new("Frame"); frame.Size = UDim2.fromOffset(260, 90); frame.Position = UDim2.new(0.5, 40, 0.5, -45); frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20); frame.BorderSizePixel = 0; frame.BackgroundTransparency = 0.1; frame.Visible = false; frame.Parent = gui
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8); local stroke = Instance.new("UIStroke", frame); stroke.Thickness = 1.5; stroke.Color = Color3.fromRGB(0, 255, 135)
    local view = Instance.new("ViewportFrame", frame); view.Size = UDim2.fromOffset(80, 80); view.Position = UDim2.fromOffset(5, 5); view.BackgroundColor3 = Color3.fromRGB(30, 30, 30); view.BackgroundTransparency = 0.5; Instance.new("UICorner", view).CornerRadius = UDim.new(0, 6)
    local nameLbl = Instance.new("TextLabel", frame); nameLbl.Size = UDim2.new(1, -95, 0, 25); nameLbl.Position = UDim2.fromOffset(90, 5); nameLbl.BackgroundTransparency = 1; nameLbl.TextColor3 = Color3.fromRGB(255, 255, 255); nameLbl.Font = Enum.Font.GothamBold; nameLbl.TextSize = 16; nameLbl.TextXAlignment = Enum.TextXAlignment.Left; nameLbl.TextTruncate = Enum.TextTruncate.AtEnd
    local toolLbl = Instance.new("TextLabel", frame); toolLbl.Size = UDim2.new(1, -95, 0, 20); toolLbl.Position = UDim2.fromOffset(90, 30); toolLbl.BackgroundTransparency = 1; toolLbl.TextColor3 = Color3.fromRGB(200, 200, 200); toolLbl.Font = Enum.Font.Gotham; toolLbl.TextSize = 13; toolLbl.TextXAlignment = Enum.TextXAlignment.Left
    local hpBg = Instance.new("Frame", frame); hpBg.Size = UDim2.new(1, -100, 0, 6); hpBg.Position = UDim2.fromOffset(90, 65); hpBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40); hpBg.BorderSizePixel = 0; Instance.new("UICorner", hpBg)
    local hpFill = Instance.new("Frame", hpBg); hpFill.Size = UDim2.fromScale(1, 1); hpFill.BackgroundColor3 = Color3.fromRGB(0, 255, 100); hpFill.BorderSizePixel = 0; Instance.new("UICorner", hpFill)
    local hpText = Instance.new("TextLabel", frame); hpText.Size = UDim2.new(1, -100, 0, 15); hpText.Position = UDim2.fromOffset(90, 72); hpText.BackgroundTransparency = 1; hpText.TextColor3 = Color3.fromRGB(150, 150, 150); hpText.Font = Enum.Font.GothamBold; hpText.TextSize = 11; hpText.TextXAlignment = Enum.TextXAlignment.Left

    TargetHUD.Gui = gui; TargetHUD.Container = frame; TargetHUD.Viewport = view; TargetHUD.NameLabel = nameLbl; TargetHUD.ToolLabel = toolLbl; TargetHUD.HealthBar = hpFill; TargetHUD.HealthText = hpText
end

local function UpdateTargetHUD(target)
    if not TargetHUD.Gui then CreateTargetHUD() end
    if not target or not target.Character then TargetHUD.Container.Visible = false; TargetHUD.CurrentTarget = nil; return end

    TargetHUD.Container.Visible = true
    TargetHUD.NameLabel.Text = target.Name
    local hum = target.Character:FindFirstChild("Humanoid")
    if hum then
        local hp = math.floor(hum.Health); local maxHp = math.floor(hum.MaxHealth)
        TargetHUD.HealthBar.Size = UDim2.fromScale(math.clamp(hp/maxHp, 0, 1), 1)
        TargetHUD.HealthBar.BackgroundColor3 = Color3.fromHSV((hp/maxHp)*0.3, 1, 1)
        TargetHUD.HealthText.Text = hp .. " / " .. maxHp .. " HP"
    end
    local tool = target.Character:FindFirstChildOfClass("Tool")
    TargetHUD.ToolLabel.Text = tool and ("Holding: " .. tool.Name) or "Holding: None"

    if TargetHUD.CurrentTarget ~= target then
        TargetHUD.CurrentTarget = target
        TargetHUD.Viewport:ClearAllChildren()
        local worldModel = Instance.new("WorldModel"); worldModel.Parent = TargetHUD.Viewport
        local cam = Instance.new("Camera"); cam.Parent = TargetHUD.Viewport; TargetHUD.Viewport.CurrentCamera = cam
        target.Character.Archivable = true
        local clone = target.Character:Clone(); clone.Parent = worldModel
        local root = clone:FindFirstChild("HumanoidRootPart") or clone:FindFirstChild("Torso") or clone:FindFirstChild("Head")
        if root then cam.CFrame = CFrame.new(root.Position + (root.CFrame.LookVector * 5) + Vector3.new(0, 2, 0), root.Position) end
        for _, v in pairs(clone:GetDescendants()) do if v:IsA("Script") or v:IsA("LocalScript") then v:Destroy() end end
    end
end
CreateTargetHUD()

-- // 5. Aimlock System // --
local Aimlock = {
    Enabled = false, Key = Enum.KeyCode.E, IsHolding = false, LockedTarget = nil,
    FOV = 100, ShowFOV = false, Smoothing = 0, TargetPart = "Head",
    TeamCheck = false, WallCheck = false, UseHUD = true
}

local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 1.5; FOVCircle.NumSides = 64; FOVCircle.Radius = 100; FOVCircle.Filled = false; FOVCircle.Visible = false; FOVCircle.Color = Color3.fromRGB(255, 255, 255)

local function IsVisible(targetPart)
    if not Aimlock.WallCheck then return true end
    local origin = Camera.CFrame.Position
    local direction = targetPart.Position - origin
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    params.FilterType = Enum.RaycastFilterType.Exclude
    local result = Workspace:Raycast(origin, direction, params)
    return (result and result.Instance:IsDescendantOf(targetPart.Parent))
end

local function GetBestTarget()
    local closest = nil
    local shortestDist = Aimlock.FOV
    local mousePos = Vector2.new(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y)

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            if Aimlock.TeamCheck and plr.Team == LocalPlayer.Team then continue end
            local char = plr.Character
            local hum = char and char:FindFirstChild("Humanoid")
            local part = char and char:FindFirstChild(Aimlock.TargetPart)
            if char and hum and hum.Health > 0 and part then
                local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
                if onScreen then
                    local dist = (mousePos - Vector2.new(pos.X, pos.Y)).Magnitude
                    if dist < shortestDist then
                        if IsVisible(part) then closest = plr; shortestDist = dist end
                    end
                end
            end
        end
    end
    return closest
end

UserInputService.InputBegan:Connect(function(input) if input.KeyCode == Aimlock.Key and Aimlock.Enabled then Aimlock.IsHolding = true; Aimlock.LockedTarget = GetBestTarget() end end)
UserInputService.InputEnded:Connect(function(input) if input.KeyCode == Aimlock.Key then Aimlock.IsHolding = false; Aimlock.LockedTarget = nil; UpdateTargetHUD(nil) end end)

local AimLoop = RunService.RenderStepped:Connect(function()
    FOVCircle.Visible = Aimlock.Enabled and Aimlock.ShowFOV
    FOVCircle.Radius = Aimlock.FOV
    FOVCircle.Position = UserInputService:GetMouseLocation()
    if Aimlock.Enabled and Aimlock.IsHolding and Aimlock.LockedTarget then
        local target = Aimlock.LockedTarget
        local char = target.Character
        local part = char and char:FindFirstChild(Aimlock.TargetPart)
        if char and part then
            if Aimlock.UseHUD then UpdateTargetHUD(target) else UpdateTargetHUD(nil) end
            if Aimlock.WallCheck and not IsVisible(part) then Aimlock.LockedTarget = nil; UpdateTargetHUD(nil); return end
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, part.Position), 1 / (Aimlock.Smoothing + 1))
        else Aimlock.LockedTarget = nil; UpdateTargetHUD(nil) end
    else UpdateTargetHUD(nil) end
end)
table.insert(Connections, AimLoop)

-- // 6. UI Creation // --
local Window = WindUI:CreateWindow({
    Title = "ro-archive  |  v6 Community",
    Author = "sdwird",
    Folder = "ro-archive-v6",
    Icon = "archive", 
    IconSize = 20,
    NewElements = true,
    Transparent = true, 
    Theme = "Dark",
    KeySystem = { Title = "Security", Note = "Key: 1234", KeyValidator = function(k) return k == "1234" end }
})

-- [MERGE] Tag from Example
Window:Tag({
    Title = "v6.0.0",
    Icon = "github",
    Color = Color3.fromHex("#1c1c1c")
})

local MainSection = Window:Section({ Title = "Dashboard" })
local PlayerSection = Window:Section({ Title = "Player & Combat" })
local CloudSection = Window:Section({ Title = "Cloud" })
local DemoSection = Window:Section({ Title = "WindUI Demo" }) -- [MERGE] New Section for Example Elements
local ConfigSection = Window:Section({ Title = "Profiles" })
local SettingsSection = Window:Section({ Title = "Settings" })

-- [MERGE] Dashboard + Dynamic Discord Check from Example
local HomeTab = MainSection:Tab({ Title = "Home", Icon = "solar:Home2Bold" })

-- Fetch Discord Info Logic (from Example, adapted)
local InviteCode = "ftgs-development-hub-1300692552005189632" -- Example Invite Code (Change to yours)
local DiscordInfo = { Name = "Discord Server", Desc = "Join our community!", Icon = "rbxassetid://129260712070622" }

task.spawn(function()
    local ok, response = pcall(function()
        return HttpService:JSONDecode(game:HttpGet("https://discord.com/api/v10/invites/" .. InviteCode .. "?with_counts=true&with_expiration=true"))
    end)
    if ok and response and response.guild then
        DiscordInfo.Name = response.guild.name
        DiscordInfo.Desc = response.guild.description or "Join our community!"
        DiscordInfo.Icon = "https://cdn.discordapp.com/icons/" .. response.guild.id .. "/" .. response.guild.icon .. ".png?size=1024"
    end
end)

HomeTab:Paragraph({
    Title = "Welcome, " .. LocalPlayer.Name,
    Desc = "ro-archive v6 Community Edition.\nBuild Status: Release\nGame ID: " .. game.GameId,
    Image = DiscordInfo.Icon, 
    ImageSize = 64,
    Buttons = {
        {
            Title = "Copy Discord",
            Icon = "link",
            Callback = function() setclipboard("https://discord.gg/" .. InviteCode) end
        },
        {
            Title = "Unload Script",
            Icon = "trash",
            Callback = function() 
                for _, conn in pairs(Connections) do conn:Disconnect() end
                for _, plr in pairs(Players:GetPlayers()) do ClearESP(plr) end
                UpdateTargetHUD(nil)
                FOVCircle:Remove()
                if TargetHUD.Gui then TargetHUD.Gui:Destroy() end
                Window:Destroy()
            end
        }
    }
})

-- ADVANCED FEEDBACK SYSTEM --
local FeedbackTab = MainSection:Tab({ Title = "Feedback", Icon = "message-square" })
local FeedbackMsg = ""
local FeedbackType = "Bug Report"
local StarRating = "⭐⭐⭐⭐⭐"

FeedbackTab:Section({ Title = "Rate & Report" })

FeedbackTab:Dropdown({
    Title = "Feedback Type",
    Values = {"Bug Report", "Suggestion", "Feature Request", "Just Rating"},
    Value = "Bug Report",
    Callback = function(v) FeedbackType = v end
})

FeedbackTab:Dropdown({
    Title = "Rate Us",
    Values = {"⭐⭐⭐⭐⭐", "⭐⭐⭐⭐", "⭐⭐⭐", "⭐⭐", "⭐"},
    Value = "⭐⭐⭐⭐⭐",
    Callback = function(v) StarRating = v end
})

FeedbackTab:Input({
    Title = "Message",
    Placeholder = "Describe your issue or idea...",
    Callback = function(v) FeedbackMsg = v end
})

FeedbackTab:Button({
    Title = "Send Feedback",
    Icon = "send",
    Callback = function()
        WindUI:Notify({ Title = "Sending...", Content = "Please wait.", Icon = "loader" })
        
        -- Sending logic
        if FeedbackType == "Just Rating" then
             sendWebhook("User just submitted a rating.", StarRating, FeedbackType)
             WindUI:Notify({ Title = "Thanks!", Content = "We appreciate your rating.", Icon = "star" })
        elseif FeedbackMsg ~= "" then
             sendWebhook(FeedbackMsg, StarRating, FeedbackType)
             WindUI:Notify({ Title = "Sent!", Content = "Thank you for your feedback.", Icon = "check" })
        else
             WindUI:Notify({ Title = "Error", Content = "Message cannot be empty for reports.", Icon = "alert-circle" })
        end
    end
})

-- Hubs Tab
local HubsTab = MainSection:Tab({ Title = "Universal Hubs", Icon = "globe" })
HubsTab:Section({ Title = "Hubs" })
HubsTab:Button({ Title = "Infinite Yield", Icon = "terminal", Callback = function() safeLoad("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", false) end })
HubsTab:Button({ Title = "Orca Hub", Icon = "fish", Callback = function() safeLoad("https://raw.githubusercontent.com/richie0866/orca/master/public/latest.lua", false) end })
HubsTab:Button({ Title = "Nameless Admin", Icon = "shield-check", Callback = function() safeLoad("https://raw.githubusercontent.com/FilteringEnabled/NamelessAdmin/main/Source", false) end })
HubsTab:Button({ Title = "Sirius", Icon = "star", Callback = function() safeLoad("https://sirius.menu/sirius", false) end })

HubsTab:Section({ Title = "Solara Specific" })
HubsTab:Button({ Title = "Skibidi Solara (Orion)", Icon = "zap", Callback = function() safeLoad("https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/skibidi-solara-hub.lua", false) end })
HubsTab:Button({ Title = "Skibidi Solara (Auto)", Icon = "radar", Callback = function() safeLoad("https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/skibidihub-rayfield", false) end })
HubsTab:Button({ Title = "Solara Hub (Normal)", Icon = "folder-open", Callback = function() safeLoad("https://raw.githubusercontent.com/sdwird/ro-archive/refs/heads/main/solara-hub.lua", false) end })

HubsTab:Section({ Title = "Tools" })
HubsTab:Button({ Title = "Dex Explorer", Icon = "search-code", Callback = function() safeLoad("https://raw.githubusercontent.com/Babyhamsta/RBLX_Scripts/main/Universal/BypassedDarkDexV3.lua", false) end })
HubsTab:Button({ Title = "Turtle Spy", Icon = "bug", Callback = function() safeLoad("https://raw.githubusercontent.com/Turtle-Brand/Turtle-Spy/main/source.lua", false) end })

-- [ PLAYER MOVEMENT ] --
local MoveTab = PlayerSection:Tab({ Title = "Movement", Icon = "footprints" })
MoveTab:Slider({ Flag = "WalkSpeed", Title = "Walk Speed", Value = { Min = 16, Max = 300, Default = 16 }, Callback = function(v) PlayerConfig.Speed = v end })
MoveTab:Toggle({ Flag = "LoopSpeed", Title = "Loop Speed", Value = false, Callback = function(v) PlayerConfig.LoopSpeed = v end })
MoveTab:Slider({ Flag = "JumpPower", Title = "Jump Power", Value = { Min = 50, Max = 300, Default = 50 }, Callback = function(v) PlayerConfig.Jump = v end })
MoveTab:Toggle({ Flag = "LoopJump", Title = "Loop Jump", Value = false, Callback = function(v) PlayerConfig.LoopJump = v end })

-- [ PLAYER INTERACTION ] --
local InteractTab = PlayerSection:Tab({ Title = "Interaction", Icon = "users" })
local SelectedPlayer = nil
local PlayerDrop = InteractTab:Dropdown({
    Title = "Select Player",
    Values = {},
    Callback = function(v) SelectedPlayer = Players:FindFirstChild(v) end
})
local function RefreshPlayers()
    local names = {}
    for _, v in pairs(Players:GetPlayers()) do if v ~= LocalPlayer then table.insert(names, v.Name) end end
    PlayerDrop:Refresh(names)
end
InteractTab:Button({ Title = "Refresh List", Icon = "refresh-cw", Callback = RefreshPlayers })
InteractTab:Button({
    Title = "Teleport to Player", Icon = "arrow-right",
    Callback = function()
        if SelectedPlayer and SelectedPlayer.Character and SelectedPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character then
            LocalPlayer.Character.HumanoidRootPart.CFrame = SelectedPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, 3)
        else WindUI:Notify({ Title = "Error", Content = "Invalid target or player dead.", Icon = "alert-circle" }) end
    end
})
InteractTab:Toggle({
    Title = "Spectate Player",
    Callback = function(v)
        if v and SelectedPlayer and SelectedPlayer.Character then
            Camera.CameraSubject = SelectedPlayer.Character.Humanoid
        else
            Camera.CameraSubject = LocalPlayer.Character.Humanoid
        end
    end
})
RefreshPlayers()

-- [ VISUALS ] --
local VisualsTab = PlayerSection:Tab({ Title = "Visuals", Icon = "eye" })
VisualsTab:Toggle({ Flag = "EspMaster", Title = "Enable ESP", Value = false, Callback = function(v) ESP.Enabled = v end })
VisualsTab:Dropdown({
    Flag = "EspElements", Title = "ESP Elements", Desc = "Select active visual elements",
    Values = { { Title = "Boxes", Icon = "solar:CheckSquareBold" }, { Title = "Names", Icon = "text" }, { Title = "Health", Icon = "activity" }, { Title = "Tracers", Icon = "move" }, { Title = "Skeleton", Icon = "user" }, { Title = "Chams", Icon = "sun" } },
    Multi = true, Value = {},
    Callback = function(items)
        ESP.Boxes = false; ESP.Names = false; ESP.Health = false; ESP.Tracers = false; ESP.Skeleton = false; ESP.Chams = false
        for _, item in pairs(items) do
            local val = (type(item) == "table" and item.Title) or item
            if val == "Boxes" then ESP.Boxes = true end
            if val == "Names" then ESP.Names = true end
            if val == "Health" then ESP.Health = true end
            if val == "Tracers" then ESP.Tracers = true end
            if val == "Skeleton" then ESP.Skeleton = true end
            if val == "Chams" then ESP.Chams = true end
        end
    end
})
VisualsTab:Section({ Title = "Settings" })
VisualsTab:Toggle({ Flag = "EspTeamCheck", Title = "Team Check", Value = false, Callback = function(v) ESP.TeamCheck = v end })
VisualsTab:Colorpicker({ Flag = "EspEnemyColor", Title = "Enemy Color", Default = Color3.fromRGB(255, 60, 60), Callback = function(v) ESP.EnemyColor = v end })
VisualsTab:Colorpicker({ Flag = "EspTeamColor", Title = "Team Color", Default = Color3.fromRGB(60, 255, 60), Callback = function(v) ESP.TeamColor = v end })

-- [ COMBAT ] --
local CombatTab = PlayerSection:Tab({ Title = "Combat", Icon = "crosshair" })
CombatTab:Toggle({ Flag = "AimEnabled", Title = "Enable Aimlock", Value = false, Callback = function(v) Aimlock.Enabled = v end })
CombatTab:Keybind({ Flag = "AimKey", Title = "Aim Key", Value = "E", Callback = function(v) Aimlock.Key = Enum.KeyCode[v] end })
CombatTab:Dropdown({ Flag = "AimPart", Title = "Target Part", Values = {"Head", "Torso", "HumanoidRootPart"}, Value = "Head", Callback = function(v) Aimlock.TargetPart = v end })
CombatTab:Slider({ Flag = "AimSmooth", Title = "Smoothing", Value = { Min = 0, Max = 10, Default = 0 }, Step = 1, Callback = function(v) Aimlock.Smoothing = v end })
CombatTab:Toggle({ Flag = "AimHud", Title = "Show Target HUD", Value = true, Callback = function(v) Aimlock.UseHUD = v end })
CombatTab:Toggle({ Flag = "AimWall", Title = "Wall Check", Value = false, Callback = function(v) Aimlock.WallCheck = v end })
CombatTab:Toggle({ Flag = "AimFovShow", Title = "Show FOV", Value = false, Callback = function(v) Aimlock.ShowFOV = v end })
CombatTab:Slider({ Flag = "AimFov", Title = "FOV Radius", Value = { Min = 10, Max = 800, Default = 100 }, Callback = function(v) Aimlock.FOV = v end })
CombatTab:Colorpicker({ Flag = "AimFovColor", Title = "FOV Color", Default = Color3.fromRGB(255, 255, 255), Callback = function(v) FOVCircle.Color = v end })

-- Cloud
local CloudTab = CloudSection:Tab({ Title = "ScriptBlox", Icon = "cloud-download" })
local currentScripts = {} 
local selectedScript = nil
local ResultsDrop

CloudTab:Input({
    Title = "Search ScriptBlox", Icon = "search",
    Callback = function(query)
        if query == "" then return end
        WindUI:Notify({ Title = "API", Content = "Searching...", Icon = "loader" })
        task.spawn(function()
            local results = fetchScriptBlox(query, "search")
            currentScripts = results
            local dropdownValues = {}
            for _, s in ipairs(results) do
                table.insert(dropdownValues, {
                    Title = s.title,
                    Desc = (s.game and s.game.name or "Unknown Game") .. " | " .. (s.views or 0) .. " views",
                    Icon = "file-code",
                    Callback = function()
                        selectedScript = s
                        local content = string.format("<b>Game:</b> %s\n<b>Views:</b> %s\n<b>Key:</b> %s", s.game and s.game.name or "?", s.views or 0, s.key and "Yes" or "No")
                        WindUI:Popup({ 
                            Title = s.title, Content = content, 
                            Buttons = {
                                { Title = "Cancel", Variant = "Secondary", Callback = function() end },
                                { Title = "Execute", Variant = "Primary", Callback = function() if s.key then setclipboard(s.keyLink) end safeLoad(s.script, true) end }
                            }
                        })
                    end
                })
            end
            if ResultsDrop then ResultsDrop:Refresh(dropdownValues) end
            WindUI:Notify({ Title = "Success", Content = #results .. " scripts found.", Icon = "check" })
        end)
    end
})
ResultsDrop = CloudTab:Dropdown({ Title = "Results", Desc = "Select to view details", Values = {}, Value = "Search first..." })

-- // [MERGE] WINDUI DEMO TAB (From Example Script) // --
local DemoTab = DemoSection:Tab({ Title = "Demo Elements", Icon = "solar:FolderWithFilesBold" })
local DemoGroup = DemoTab:Group({})

DemoGroup:Button({
    Title = "Highlight Button",
    Icon = "mouse",
    Callback = function()
        print("Clicked highlight")
        -- Note: Highlight() method usage if supported
    end
})
DemoGroup:Space()
DemoGroup:Slider({
    Title = "Demo Slider",
    Desc = "From the example script",
    IsTooltip = true, -- [MERGE] Example feature
    Step = 1,
    Value = { Min = 0, Max = 100, Default = 50 },
    Callback = function(v) print(v) end
})
DemoGroup:Space()
DemoGroup:Toggle({
    Title = "Example Toggle",
    Desc = "With Solar Icon",
    Icon = "solar:CheckSquareBold", -- [MERGE] Using Solar Icon
    Callback = function(v) print(v) end
})

-- Config Manager
local ConfigTab = ConfigSection:Tab({ Title = "Configs", Icon = "save" })
local ConfigManager = Window.ConfigManager
local ConfigName = "default"

local ConfigNameInput = ConfigTab:Input({ Title = "Config Name", Icon = "file-cog", Callback = function(v) ConfigName = v end })
ConfigTab:Space()
local AutoLoadToggle = ConfigTab:Toggle({ Title = "Auto Load Selected", Value = false, Callback = function(v) Window.CurrentConfig:SetAutoLoad(v) end })
ConfigTab:Space()
local AllConfigsDropdown = ConfigTab:Dropdown({
    Title = "Load Config", Values = ConfigManager:AllConfigs(), Value = nil,
    Callback = function(v) ConfigName = v; ConfigNameInput:Set(v); AutoLoadToggle:Set(ConfigManager:GetConfig(ConfigName).AutoLoad or false) end
})
ConfigTab:Button({ Title = "Save Config", Icon = "save", Callback = function() Window.CurrentConfig = ConfigManager:Config(ConfigName); if Window.CurrentConfig:Save() then WindUI:Notify({ Title = "Saved", Content = "Config saved: " .. ConfigName, Icon = "check" }); AllConfigsDropdown:Refresh(ConfigManager:AllConfigs()) end end })
ConfigTab:Button({ Title = "Load Config", Icon = "upload", Callback = function() Window.CurrentConfig = ConfigManager:CreateConfig(ConfigName); if Window.CurrentConfig:Load() then WindUI:Notify({ Title = "Loaded", Content = "Config loaded: " .. ConfigName, Icon = "refresh-cw" }) end end })

-- Settings
local SettingsTab = SettingsSection:Tab({ Title = "Interface", Icon = "settings" })
local themeNames = {}
for name in pairs(WindUI:GetThemes()) do table.insert(themeNames, name) end
SettingsTab:Dropdown({ Title = "Theme", Values = themeNames, Value = "Dark", Callback = function(v) WindUI:SetTheme(v) end })
SettingsTab:Keybind({ Title = "Menu Toggle", Value = "H", Callback = function(key) Window:SetToggleKey(Enum.KeyCode[key]) end })

WindUI:Notify({ Title = "ro-archive v6", Content = "Merged Community Edition Loaded.", Duration = 4 })
